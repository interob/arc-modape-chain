// For format details, see https://aka.ms/devcontainer.json. For config options, see the README at:
// https://github.com/microsoft/vscode-dev-containers/tree/v0.158.0/containers/python-3
{
    "name": "ARC MODAPE CHAIN Container",
    "dockerComposeFile": "docker-compose.development.yml",
    "service": "arc_modape_chain",
    "initializeCommand": "cat ./docker/Dockerfile <(sed -e \"s/{{user}}/$(id -un)/g\" ./development/vscode/.devcontainer/Dockerfile.template) > ./.devcontainer/Dockerfile.development && sed -e \"s#{{dockerfile}}#$(pwd)/.devcontainer/Dockerfile.development#g\" ./development/vscode/.devcontainer/docker-compose.development.yml > ./.devcontainer/docker-compose.development.yml",
    "updateRemoteUserUID": true,

    "workspaceFolder": "/arc_modape_chain/src",

    "postCreateCommand": "PIP_ROOT_USER_ACTION=ignore sudo pip install --upgrade pip && cd /arc_modape_chain/modape && PIP_ROOT_USER_ACTION=ignore sudo pip install -e . && cd /arc_modape_chain/src && PIP_ROOT_USER_ACTION=ignore pip install -e .[dev]",

    "customizations": {
        "vscode": {
            "extensions": ["ms-python.python", "eamodio.gitlens", "ms-python.flake8", "ms-python.isort", "ms-python.black-formatter"],
            "settings": {
                "python.analysis.extraPaths": [
                    "/home/${env:LOCAL_PYTHONPATH}/.local/lib/python3.11/site-packages"
                ],
                "terminal.integrated.env.osx": {
                    "PYTHONPATH": "${workspaceFolder}"
                },
                "terminal.integrated.env.linux": {
                    "PYTHONPATH": "${workspaceFolder}"
                },
                "terminal.integrated.env.windows": {
                    "PYTHONPATH": "${workspaceFolder}"
                },
                "flake8.args": [
                    "--max-line-length=120",
                    "--extend-ignore=E203",
                    "--per-file-ignores=__init__.py:F403, F401"
                ],
                "black-formatter.args": [
                    "--line-length=100"
                ],
                "editor.formatOnSave": true,
                "editor.codeActionsOnSave": {
                    "source.organizeImports": "always"
                },
                "[python]": {
                    "editor.tabSize": 4,
                    "editor.insertSpaces": true,
                    "editor.formatOnSave": true,
                    "editor.codeActionsOnSave": {
                        "source.organizeImports": "always"
                    },
                    "editor.defaultFormatter": "ms-python.black-formatter"
                },
                "isort.args": [
                    "--profile=black",
                    "--src=${workspaceFolder}"
                ],
                "python.testing.pytestArgs": [
                    "-v",
                    "--cov=./",
                    "--cov-report=xml",
                    "--pdb"
                ],
                "python.testing.unittestEnabled": false,
                "python.testing.pytestEnabled": true,
                "python.testing.promptToConfigure": true
            }
        }
    }

    // Use 'forwardPorts' to make a list of ports inside the container available locally.
    //"forwardPorts": [ 5001 ],

    //See: https://code.visualstudio.com/docs/remote/containers-advanced#_changing-the-default-source-code-mount
    // >> regarding workspaceFolder: if git is present on the host's PATH and the folder containing
    //                               .devcontainer/devcontainer.json is within a git repository, the
    //                               current workspace mounted will be the root of the repository.
    //"mounts": [
    //  "source=${localWorkspaceFolder}/storage,target=/var/storage,type=bind,consistency=cached"
    //]

    //"remoteUser": "vscode"
    //"postCreateCommand": "cd .devcontainer && ./setup_modape.sh"
}
